# üîç CHECKING COMPLET & TUTORIEL DE CONNEXION
## Ghost Remix Pack - Site E-commerce de Packs Audio

---

## üìã TABLE DES MATI√àRES

1. [√âtat Actuel du Projet](#√©tat-actuel-du-projet)
2. [V√©rification Technique](#v√©rification-technique)
3. [Configuration Requise](#configuration-requise)
4. [Tutoriel D√©taill√© de Connexion](#tutoriel-d√©taill√©-de-connexion)
5. [Tests de Fonctionnement](#tests-de-fonctionnement)
6. [D√©ploiement](#d√©ploiement)
7. [Troubleshooting](#troubleshooting)

---

## üéØ √âTAT ACTUEL DU PROJET

### ‚úÖ CE QUI EST D√âJ√Ä FAIT

#### **Frontend (React + Vite + TypeScript)**
- ‚úÖ Architecture compl√®te avec React Router
- ‚úÖ Design moderne avec Tailwind CSS
- ‚úÖ Animations avec Framer Motion
- ‚úÖ Syst√®me de panier fonctionnel (CartContext)
- ‚úÖ Pages configur√©es :
  - `/` - Page d'accueil avec packs audio
  - `/cart` - Panier
  - `/checkout` - Page de paiement
  - `/success` - Confirmation de commande
  - `/mentions-legales` - Mentions l√©gales
  - `/contact` - Contact
- ‚úÖ Composants UI professionnels
- ‚úÖ Configuration Stripe (cl√© publique configur√©e)
- ‚úÖ Lecteur audio int√©gr√©
- ‚úÖ Vid√©o d'intro avec son

#### **Backend (Node.js + Express)**
- ‚úÖ Structure compl√®te avec routes organis√©es
- ‚úÖ API Express configur√©e
- ‚úÖ Routes impl√©ment√©es :
  - `/api/checkout/create-session` - Cr√©ation de session Stripe
  - `/api/webhook` - Webhook Stripe (comment√©, √† activer)
  - `/api/download` - T√©l√©chargement de fichiers
  - `/api/health` - Test de sant√© du serveur
- ‚úÖ Services configur√©s :
  - Stripe (paiement)
  - Firebase (base de donn√©es)
  - SendGrid (emails)
- ‚úÖ Gestion CORS
- ‚úÖ Script de v√©rification de config (`check-config.js`)

#### **Configuration**
- ‚úÖ `package.json` frontend et backend
- ‚úÖ Configuration Vercel (`vercel.json`)
- ‚úÖ Configuration Railway (`railway.json`)
- ‚úÖ Variables d'environnement document√©es
- ‚úÖ Stripe en mode TEST configur√©
- ‚úÖ `.gitignore` configur√©s (s√©curit√©)

---

### ‚ö†Ô∏è CE QUI MANQUE / √Ä CONFIGURER

#### **Backend Local**
- ‚ùå Fichier `.env` non cr√©√© dans `/backend`
- ‚ùå Fichier `serviceAccountKey.json` Firebase manquant
- ‚ö†Ô∏è Webhook Stripe comment√© (√† activer apr√®s config)
- ‚ö†Ô∏è SendGrid √† configurer (optionnel mais recommand√©)

#### **Configuration Stripe**
- ‚ö†Ô∏è Webhook Stripe √† cr√©er (pour notifications de paiement)
- ‚ö†Ô∏è Produits Stripe √† cr√©er (si utilisation API Stripe)

#### **Firebase**
- ‚ùå Projet Firebase √† cr√©er
- ‚ùå Cl√© de service √† t√©l√©charger

#### **SendGrid**
- ‚ùå Compte SendGrid √† cr√©er
- ‚ùå Cl√© API √† g√©n√©rer
- ‚ùå Email exp√©diteur √† v√©rifier

#### **D√©ploiement**
- ‚ö†Ô∏è Backend √† d√©ployer sur Railway
- ‚ö†Ô∏è Frontend √† d√©ployer sur Vercel
- ‚ö†Ô∏è Variables d'environnement √† configurer en production

---

## üîç V√âRIFICATION TECHNIQUE

### **Structure des Fichiers**

```
‚úÖ Frontend
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/        ‚úÖ Tous les composants pr√©sents
‚îÇ   ‚îú‚îÄ‚îÄ config/            ‚úÖ stripe.ts configur√©
‚îÇ   ‚îú‚îÄ‚îÄ context/           ‚úÖ CartContext.tsx
‚îÇ   ‚îú‚îÄ‚îÄ lib/               ‚úÖ utils.ts
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx            ‚úÖ Routes configur√©es
‚îÇ   ‚îî‚îÄ‚îÄ main.tsx           ‚úÖ Point d'entr√©e
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ audio/             ‚úÖ Structure pr√©sente
‚îÇ   ‚îî‚îÄ‚îÄ videos/            ‚úÖ Vid√©o pr√©sente
‚îú‚îÄ‚îÄ package.json           ‚úÖ D√©pendances compl√®tes
‚îî‚îÄ‚îÄ vite.config.ts         ‚úÖ Configuration Vite

‚úÖ Backend
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ checkout.js        ‚úÖ Route de paiement
‚îÇ   ‚îú‚îÄ‚îÄ webhook.js         ‚úÖ Route webhook (comment√©e)
‚îÇ   ‚îî‚îÄ‚îÄ download.js        ‚úÖ Route de t√©l√©chargement
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ stripe.js          ‚úÖ Service Stripe
‚îÇ   ‚îú‚îÄ‚îÄ firebase.js        ‚úÖ Service Firebase
‚îÇ   ‚îî‚îÄ‚îÄ email.js           ‚úÖ Service Email
‚îú‚îÄ‚îÄ server.js              ‚úÖ Serveur Express
‚îú‚îÄ‚îÄ check-config.js        ‚úÖ Script de v√©rification
‚îú‚îÄ‚îÄ env.example            ‚úÖ Template des variables
‚îî‚îÄ‚îÄ ‚ùå .env                MANQUANT - √Ä CR√âER
‚îî‚îÄ‚îÄ ‚ùå serviceAccountKey.json  MANQUANT - √Ä T√âL√âCHARGER
```

### **Variables d'Environnement**

#### **Frontend**
```bash
‚úÖ VITE_BACKEND_URL    # √Ä d√©finir pour production
                       # Local: http://localhost:3001
                       # Prod: https://votre-backend.railway.app
```

#### **Backend** (fichier `.env` √† cr√©er)
```bash
# STRIPE
‚úÖ STRIPE_SECRET_KEY       # D√©j√† fournie
‚úÖ STRIPE_PUBLISHABLE_KEY  # D√©j√† fournie
‚ùå STRIPE_WEBHOOK_SECRET   # √Ä cr√©er

# FIREBASE
‚ùå FIREBASE_PROJECT_ID     # √Ä cr√©er projet Firebase

# SENDGRID
‚ùå SENDGRID_API_KEY        # √Ä cr√©er compte SendGrid
‚ùå SENDGRID_FROM_EMAIL     # √Ä v√©rifier l'email

# SERVEUR
‚úÖ PORT                    # 3001
‚úÖ FRONTEND_URL            # Fournie
‚úÖ NODE_ENV                # development/production
```

---

## üìù CONFIGURATION REQUISE

### **Comptes √† Cr√©er/Avoir**

1. **Stripe** (Paiement)
   - ‚úÖ Compte cr√©√©
   - ‚úÖ Cl√©s API obtenues
   - ‚ùå Webhook √† cr√©er

2. **Firebase** (Base de donn√©es)
   - ‚ùå Cr√©er un projet Firebase
   - ‚ùå T√©l√©charger cl√© de service

3. **SendGrid** (Emails) - OPTIONNEL
   - ‚ùå Cr√©er compte SendGrid (gratuit)
   - ‚ùå G√©n√©rer cl√© API

4. **Railway** (H√©bergement Backend)
   - ‚ùå Cr√©er compte Railway
   - ‚ùå Connecter GitHub

5. **Vercel** (H√©bergement Frontend)
   - ‚úÖ Compte probablement cr√©√©
   - ‚ùå V√©rifier configuration

6. **GitHub** (Code source)
   - ‚ùå Repository √† cr√©er/utiliser

---

## üöÄ TUTORIEL D√âTAILL√â DE CONNEXION

### **√âTAPE 1 : Configuration du Backend Local**

#### 1.1 - Cr√©er le fichier `.env`

```bash
cd backend
cp env.example .env
```

#### 1.2 - √âditer le fichier `.env`

Ouvrez `backend/.env` et configurez :

```bash
# ==========================================
# STRIPE - Paiement
# ==========================================
STRIPE_SECRET_KEY=sk_test_VOTRE_CLE_TEST_ICI
STRIPE_PUBLISHABLE_KEY=pk_test_VOTRE_CLE_PUBLIQUE_TEST_ICI
STRIPE_WEBHOOK_SECRET=whsec_VOTRE_WEBHOOK_SECRET_ICI
# ‚ö†Ô∏è √Ä remplacer apr√®s cr√©ation du webhook (√©tape 2)

# ==========================================
# FIREBASE - Base de donn√©es
# ==========================================
FIREBASE_PROJECT_ID=ghost-remix-pack
# ‚ö†Ô∏è √Ä remplacer par votre vrai ID apr√®s cr√©ation (√©tape 3)

# ==========================================
# SENDGRID - Emails (OPTIONNEL)
# ==========================================
SENDGRID_API_KEY=SG.VOTRE_CLE_ICI
# ‚ö†Ô∏è √Ä cr√©er si vous voulez envoyer des emails (√©tape 4)
SENDGRID_FROM_EMAIL=contact@votre-domaine.com
# ‚ö†Ô∏è Email v√©rifi√© dans SendGrid

# ==========================================
# SERVEUR - Configuration
# ==========================================
PORT=3001
FRONTEND_URL=http://localhost:5173
NODE_ENV=development

# ==========================================
# URLS - Redirection apr√®s paiement
# ==========================================
SUCCESS_URL=http://localhost:5173/success
CANCEL_URL=http://localhost:5173/cart
```

---

### **√âTAPE 2 : Configuration Stripe Webhook**

#### 2.1 - Installer Stripe CLI (pour tests locaux)

**Mac/Linux :**
```bash
brew install stripe/stripe-cli/stripe
```

**Windows :**
T√©l√©chargez depuis : https://github.com/stripe/stripe-cli/releases

#### 2.2 - Authentifier Stripe CLI

```bash
stripe login
```

Une fen√™tre de navigateur s'ouvrira pour vous connecter.

#### 2.3 - D√©marrer le webhook local

```bash
stripe listen --forward-to localhost:3001/api/webhook
```

Vous obtiendrez un secret webhook comme :
```
> Ready! Your webhook signing secret is whsec_VOTRE_WEBHOOK_SECRET_ICI
```

#### 2.4 - Copier le secret webhook

Copiez le secret `whsec_VOTRE_WEBHOOK_SECRET_ICI` et mettez-le dans `backend/.env` :

```bash
STRIPE_WEBHOOK_SECRET=whsec_VOTRE_WEBHOOK_SECRET_ICI
```

#### 2.5 - Activer le webhook dans le code

Ouvrez `backend/server.js` et **d√©commentez** ces lignes :

**AVANT :**
```javascript
// ‚ö†Ô∏è Comment√© temporairement si webhook non configur√©
// app.use('/api/webhook', express.raw({ type: 'application/json' }));

// ...

// ‚ö†Ô∏è Webhook comment√© temporairement (√† activer apr√®s cr√©ation webhook)
// app.use('/api/webhook', webhookRouter);
```

**APR√àS :**
```javascript
// IMPORTANT : Le webhook Stripe n√©cessite le raw body
app.use('/api/webhook', express.raw({ type: 'application/json' }));

// ...

// Routes
app.use('/api/webhook', webhookRouter);
```

---

### **√âTAPE 3 : Configuration Firebase**

#### 3.1 - Cr√©er un projet Firebase

1. Allez sur https://console.firebase.google.com
2. Cliquez sur **"Ajouter un projet"**
3. Nom du projet : `ghost-remix-pack` (ou autre)
4. D√©sactivez Google Analytics (optionnel)
5. Cliquez sur **"Cr√©er un projet"**

#### 3.2 - Activer Firestore Database

1. Dans le menu de gauche, cliquez sur **"Firestore Database"**
2. Cliquez sur **"Cr√©er une base de donn√©es"**
3. Choisissez **"D√©marrer en mode test"** (pour d√©veloppement)
4. Choisissez une r√©gion proche (ex : `europe-west1`)
5. Cliquez sur **"Activer"**

#### 3.3 - T√©l√©charger la cl√© de service

1. Allez dans **Param√®tres du projet** (ic√¥ne engrenage)
2. Onglet **"Comptes de service"**
3. Cliquez sur **"G√©n√©rer une nouvelle cl√© priv√©e"**
4. Un fichier JSON sera t√©l√©charg√©
5. **Renommez-le** en `serviceAccountKey.json`
6. **D√©placez-le** dans le dossier `backend/`

```bash
mv ~/Downloads/ghost-remix-pack-xxxxx.json backend/serviceAccountKey.json
```

‚ö†Ô∏è **IMPORTANT** : Ce fichier NE DOIT JAMAIS √™tre commit√© sur Git (d√©j√† dans `.gitignore`)

#### 3.4 - Copier l'ID du projet

Dans le fichier `serviceAccountKey.json`, trouvez `project_id` :

```json
{
  "project_id": "ghost-remix-pack-xxxxx",
  ...
}
```

Mettez cet ID dans `backend/.env` :

```bash
FIREBASE_PROJECT_ID=ghost-remix-pack-xxxxx
```

---

### **√âTAPE 4 : Configuration SendGrid (OPTIONNEL)**

> üí° **Optionnel mais recommand√©** pour envoyer des emails de confirmation

#### 4.1 - Cr√©er un compte SendGrid

1. Allez sur https://signup.sendgrid.com
2. Cr√©ez un compte gratuit (100 emails/jour)
3. Validez votre email

#### 4.2 - Cr√©er une cl√© API

1. Allez dans **Settings** ‚Üí **API Keys**
2. Cliquez sur **"Create API Key"**
3. Nom : `Ghost Remix Pack`
4. Permissions : **Full Access**
5. Cliquez sur **"Create & View"**
6. **COPIEZ LA CL√â** (elle ne sera plus visible)

#### 4.3 - Configurer la cl√© dans `.env`

```bash
SENDGRID_API_KEY=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

#### 4.4 - V√©rifier un email exp√©diteur

1. Allez dans **Settings** ‚Üí **Sender Authentication**
2. Cliquez sur **"Verify a Single Sender"**
3. Remplissez le formulaire avec votre email
4. Validez l'email re√ßu

```bash
SENDGRID_FROM_EMAIL=votre-email@gmail.com
```

> ‚ö†Ô∏è Si vous sautez cette √©tape, les emails ne seront pas envoy√©s mais le site fonctionnera quand m√™me.

---

### **√âTAPE 5 : Installation des D√©pendances**

#### 5.1 - Backend

```bash
cd backend
npm install
```

#### 5.2 - Frontend

```bash
cd ..
npm install
```

---

### **√âTAPE 6 : V√©rification de la Configuration**

```bash
cd backend
npm run check
```

Vous devriez voir :

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  üîç V√©rification de la Configuration                      ‚ïë
‚ïë  Ghost Remix Pack Backend                                 ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üîí STRIPE
  ‚úÖ STRIPE_SECRET_KEY configur√©e
  ‚ÑπÔ∏è  Mode TEST (utilisez sk_live_VOTRE_CLE_LIVE_ICI pour la production)
  ‚úÖ STRIPE_PUBLISHABLE_KEY configur√©e
  ‚úÖ STRIPE_WEBHOOK_SECRET configur√©

üóÑÔ∏è  FIREBASE
  ‚úÖ serviceAccountKey.json trouv√©
  ‚úÖ FIREBASE_PROJECT_ID: ghost-remix-pack-xxxxx

üìß SENDGRID
  ‚úÖ SENDGRID_API_KEY configur√©e
  ‚ÑπÔ∏è  Email exp√©diteur: votre-email@gmail.com

‚öôÔ∏è  SERVEUR
  ‚ÑπÔ∏è  Port: 3001
  ‚ÑπÔ∏è  Frontend URL: http://localhost:5173
  ‚ÑπÔ∏è  Mode: development

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ‚úÖ Configuration compl√®te !                              ‚ïë
‚ïë  Vous pouvez d√©marrer le serveur : npm run dev           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

### **√âTAPE 7 : D√©marrage Local**

#### 7.1 - Terminal 1 : Backend

```bash
cd backend
npm run dev
```

Vous devriez voir :
```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  üöÄ Ghost Remix Backend API               ‚ïë
‚ïë  ‚úÖ Serveur d√©marr√© sur port 3001         ‚ïë
‚ïë  üì° Frontend URL: http://localhost:5173   ‚ïë
‚ïë  üîí Stripe: Configur√© ‚úÖ                  ‚ïë
‚ïë  üóÑÔ∏è  Firebase: Configur√© ‚úÖ               ‚ïë
‚ïë  üìß SendGrid: Configur√© ‚úÖ                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

#### 7.2 - Terminal 2 : Webhook Stripe (si configur√©)

```bash
stripe listen --forward-to localhost:3001/api/webhook
```

#### 7.3 - Terminal 3 : Frontend

```bash
npm run dev
```

Le site s'ouvrira automatiquement sur http://localhost:5173

---

## ‚úÖ TESTS DE FONCTIONNEMENT

### **Test 1 : API Backend**

Ouvrez http://localhost:3001/api/health

Vous devriez voir :
```json
{
  "status": "OK",
  "message": "Ghost Remix Backend API is running",
  "timestamp": "2025-10-15T..."
}
```

### **Test 2 : Frontend**

Ouvrez http://localhost:5173

V√©rifiez :
- ‚úÖ La vid√©o d'intro se lance
- ‚úÖ Les packs audio s'affichent
- ‚úÖ Le lecteur audio fonctionne
- ‚úÖ Le bouton "Ajouter au panier" fonctionne

### **Test 3 : Panier**

1. Ajoutez un pack au panier
2. Cliquez sur l'ic√¥ne panier (en haut √† droite)
3. V√©rifiez que le pack appara√Æt
4. Modifiez la quantit√©
5. V√©rifiez que le total se met √† jour

### **Test 4 : Checkout (SANS paiement r√©el)**

1. Dans le panier, cliquez sur **"Proc√©der au paiement"**
2. Remplissez le formulaire avec des donn√©es de test :
   - Nom : Test User
   - Email : test@example.com
   - T√©l√©phone : 0612345678
3. Cliquez sur **"Payer 47‚Ç¨"**
4. Vous devriez √™tre redirig√© vers Stripe Checkout
5. Utilisez une carte de test :
   - Num√©ro : `4242 4242 4242 4242`
   - Date : n'importe quelle date future
   - CVC : n'importe quel 3 chiffres
6. Compl√©tez le paiement
7. Vous devriez √™tre redirig√© vers `/success`

### **Test 5 : Webhook**

Si le webhook est configur√©, dans le terminal o√π `stripe listen` tourne, vous devriez voir :

```
2025-10-15 10:30:45  --> checkout.session.completed [evt_xxx]
2025-10-15 10:30:45  <-- [200] POST http://localhost:3001/api/webhook
```

---

## üåê D√âPLOIEMENT EN PRODUCTION

### **√âTAPE 1 : Pr√©parer GitHub**

#### 1.1 - Cr√©er un repository GitHub

```bash
# Depuis votre projet
git init
git add .
git commit -m "Initial commit - Ghost Remix Pack"

# Cr√©er le repository sur GitHub.com
# Puis :
git remote add origin https://github.com/VOTRE-USERNAME/ghost-remix-pack.git
git branch -M main
git push -u origin main
```

---

### **√âTAPE 2 : D√©ployer le Backend sur Railway**

#### 2.1 - Cr√©er un compte Railway

1. Allez sur https://railway.app
2. Cliquez sur **"Start a New Project"**
3. Connectez votre compte GitHub

#### 2.2 - D√©ployer depuis GitHub

1. Cliquez sur **"Deploy from GitHub repo"**
2. S√©lectionnez votre repository `ghost-remix-pack`
3. Railway d√©tectera automatiquement le `railway.json`

#### 2.3 - Configurer les variables d'environnement

Dans Railway, allez dans **Variables** et ajoutez :

```bash
STRIPE_SECRET_KEY=sk_test_VOTRE_CLE_TEST_ICI
STRIPE_PUBLISHABLE_KEY=pk_test_VOTRE_CLE_PUBLIQUE_TEST_ICI
STRIPE_WEBHOOK_SECRET=(√† cr√©er apr√®s)
FIREBASE_PROJECT_ID=ghost-remix-pack-xxxxx
SENDGRID_API_KEY=SG.xxxxxxxxx
SENDGRID_FROM_EMAIL=votre-email@gmail.com
PORT=3001
NODE_ENV=production
FRONTEND_URL=https://votre-site.vercel.app
```

‚ö†Ô∏è `FRONTEND_URL` sera mise √† jour apr√®s le d√©ploiement du frontend

#### 2.4 - Ajouter le fichier Firebase

Railway ne supporte pas les fichiers upload√©s, donc convertissez `serviceAccountKey.json` en variable :

```bash
# Dans Railway, ajoutez une variable :
FIREBASE_SERVICE_ACCOUNT={"type":"service_account","project_id":"..."}
```

OU modifiez `backend/services/firebase.js` pour lire depuis une variable.

#### 2.5 - Obtenir l'URL du backend

Une fois d√©ploy√©, Railway vous donnera une URL comme :
```
https://ghost-remix-backend-production-xxxx.up.railway.app
```

**Copiez cette URL** pour la prochaine √©tape.

---

### **√âTAPE 3 : Cr√©er le Webhook Stripe en Production**

#### 3.1 - Aller sur Stripe Dashboard

1. Allez sur https://dashboard.stripe.com/test/webhooks
2. Cliquez sur **"Add endpoint"**

#### 3.2 - Configurer le webhook

- **URL** : `https://VOTRE-BACKEND.railway.app/api/webhook`
- **Description** : Ghost Remix Pack Webhook
- **Events to send** : 
  - `checkout.session.completed`
  - `payment_intent.succeeded`

#### 3.3 - Obtenir le secret

Une fois cr√©√©, cliquez sur le webhook et r√©v√©lez **"Signing secret"** :

```
whsec_VOTRE_WEBHOOK_SECRET_ICI
```

#### 3.4 - Ajouter dans Railway

Dans Railway **Variables** :
```bash
STRIPE_WEBHOOK_SECRET=whsec_VOTRE_WEBHOOK_SECRET_ICI
```

Red√©ployez le backend.

---

### **√âTAPE 4 : D√©ployer le Frontend sur Vercel**

#### 4.1 - Cr√©er un compte Vercel

1. Allez sur https://vercel.com
2. Connectez votre compte GitHub

#### 4.2 - Importer le projet

1. Cliquez sur **"Add New..." ‚Üí Project**
2. S√©lectionnez votre repository `ghost-remix-pack`
3. Framework Preset : **Vite**
4. Root Directory : `./` (racine)

#### 4.3 - Configurer les variables d'environnement

Dans **Environment Variables** :

```bash
VITE_BACKEND_URL=https://VOTRE-BACKEND.railway.app
```

‚ö†Ô∏è Remplacez par l'URL Railway obtenue √† l'√©tape 2.5

#### 4.4 - D√©ployer

Cliquez sur **"Deploy"**

Vercel construira et d√©ploiera votre site. Vous obtiendrez une URL comme :
```
https://ghost-remix-pack.vercel.app
```

#### 4.5 - Mettre √† jour Railway

Retournez dans Railway **Variables** et mettez √† jour :

```bash
FRONTEND_URL=https://ghost-remix-pack.vercel.app
```

Red√©ployez le backend.

---

### **√âTAPE 5 : Tests en Production**

#### 5.1 - Tester l'API

Ouvrez : `https://VOTRE-BACKEND.railway.app/api/health`

Vous devriez voir :
```json
{
  "status": "OK",
  "message": "Ghost Remix Backend API is running",
  ...
}
```

#### 5.2 - Tester le site

1. Ouvrez : `https://VOTRE-SITE.vercel.app`
2. Ajoutez un produit au panier
3. Proc√©dez au checkout
4. Utilisez la carte de test Stripe : `4242 4242 4242 4242`
5. Validez le paiement
6. V√©rifiez la redirection vers `/success`

#### 5.3 - V√©rifier les webhooks

Dans Stripe Dashboard ‚Üí Webhooks, v√©rifiez que les √©v√©nements sont bien re√ßus (statut 200).

---

## üêõ TROUBLESHOOTING

### **Probl√®me 1 : Backend ne d√©marre pas**

**Erreur :** `Cannot find module 'dotenv'`

**Solution :**
```bash
cd backend
npm install
```

---

### **Probl√®me 2 : Stripe API Error**

**Erreur :** `Invalid API Key provided`

**Solution :**
- V√©rifiez que `STRIPE_SECRET_KEY` dans `.env` commence par `sk_test_VOTRE_CLE_TEST_ICI` ou `sk_live_VOTRE_CLE_LIVE_ICI`
- V√©rifiez qu'il n'y a pas d'espaces avant/apr√®s la cl√©
- Obtenez une nouvelle cl√© sur https://dashboard.stripe.com/test/apikeys

---

### **Probl√®me 3 : CORS Error**

**Erreur :** `Access to fetch at 'http://localhost:3001/api/...' from origin 'http://localhost:5173' has been blocked by CORS`

**Solution :**

Dans `backend/server.js`, v√©rifiez :
```javascript
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:5173',
  credentials: true
}));
```

Et dans `.env` :
```bash
FRONTEND_URL=http://localhost:5173
```

---

### **Probl√®me 4 : Firebase Error**

**Erreur :** `Error: Firebase service account key not found`

**Solution :**
- V√©rifiez que `serviceAccountKey.json` est dans le dossier `backend/`
- V√©rifiez que le fichier n'est pas vide
- Re-t√©l√©chargez la cl√© depuis Firebase Console

---

### **Probl√®me 5 : Webhook ne fonctionne pas**

**Erreur :** Webhook endpoint returned an error

**Solution :**

1. V√©rifiez que le webhook est activ√© dans `server.js`
2. V√©rifiez que `STRIPE_WEBHOOK_SECRET` est configur√©
3. Pour le local, assurez-vous que `stripe listen` tourne
4. Pour la production, v√©rifiez l'URL du webhook sur Stripe Dashboard

---

### **Probl√®me 6 : Paiement ne redirige pas**

**Erreur :** Apr√®s paiement, je reste sur Stripe

**Solution :**

Dans `backend/services/stripe.js`, v√©rifiez :
```javascript
success_url: `${process.env.FRONTEND_URL}/success?session_id={CHECKOUT_SESSION_ID}`,
cancel_url: `${process.env.FRONTEND_URL}/cart`,
```

Et dans `.env` :
```bash
FRONTEND_URL=http://localhost:5173  # ou votre URL de prod
```

---

### **Probl√®me 7 : SendGrid emails ne partent pas**

**Erreur :** SendGrid API error

**Solution :**

1. V√©rifiez que l'email exp√©diteur est v√©rifi√© dans SendGrid
2. V√©rifiez que la cl√© API a les permissions **Full Access**
3. Si en mode gratuit, vous √™tes limit√© √† 100 emails/jour

Pour tester sans SendGrid, commentez les appels dans `backend/services/email.js`

---

### **Probl√®me 8 : Fichiers audio ne se chargent pas**

**Erreur :** Failed to load audio

**Solution :**

1. V√©rifiez que les fichiers sont dans `public/audio/`
2. V√©rifiez les noms de fichiers dans le code (casse importante)
3. Formats support√©s : `.mp3`, `.wav`, `.ogg`

---

### **Probl√®me 9 : Build Vercel √©choue**

**Erreur :** `Build failed`

**Solution :**

1. V√©rifiez qu'il n'y a pas d'erreurs TypeScript :
```bash
npm run build
```

2. V√©rifiez que `vercel.json` est correct
3. Dans Vercel, v√©rifiez que le Framework est **Vite**

---

### **Probl√®me 10 : Railway ne trouve pas le backend**

**Erreur :** `No such file or directory: backend/server.js`

**Solution :**

V√©rifiez `railway.json` :
```json
{
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "cd backend && npm install"
  },
  "deploy": {
    "startCommand": "cd backend && npm start"
  }
}
```

---

## üìä R√âCAPITULATIF DES URLS

### **D√©veloppement Local**

| Service | URL |
|---------|-----|
| Frontend | http://localhost:5173 |
| Backend API | http://localhost:3001 |
| Backend Health Check | http://localhost:3001/api/health |
| Stripe Dashboard | https://dashboard.stripe.com/test |
| Firebase Console | https://console.firebase.google.com |
| SendGrid Dashboard | https://app.sendgrid.com |

### **Production**

| Service | URL |
|---------|-----|
| Frontend | https://votre-site.vercel.app |
| Backend API | https://votre-backend.railway.app |
| Backend Health Check | https://votre-backend.railway.app/api/health |
| Stripe Webhook | https://votre-backend.railway.app/api/webhook |

---

## üìû SUPPORT

### **Ressources Utiles**

- [Documentation Stripe](https://stripe.com/docs)
- [Documentation Firebase](https://firebase.google.com/docs)
- [Documentation SendGrid](https://docs.sendgrid.com)
- [Documentation Railway](https://docs.railway.app)
- [Documentation Vercel](https://vercel.com/docs)

### **Fichiers de Configuration**

- `backend/.env` - Variables d'environnement backend
- `backend/serviceAccountKey.json` - Cl√© Firebase
- `src/config/stripe.ts` - Configuration Stripe frontend
- `vercel.json` - Configuration Vercel
- `railway.json` - Configuration Railway

---

## ‚úÖ CHECKLIST FINALE

### **Configuration Locale**

- [ ] `backend/.env` cr√©√© et rempli
- [ ] `backend/serviceAccountKey.json` t√©l√©charg√©
- [ ] D√©pendances install√©es (frontend + backend)
- [ ] Backend d√©marre sur port 3001
- [ ] Frontend d√©marre sur port 5173
- [ ] Stripe webhook configur√© (local)
- [ ] Test de paiement r√©ussi

### **D√©ploiement**

- [ ] Code push√© sur GitHub
- [ ] Backend d√©ploy√© sur Railway
- [ ] Variables d'environnement Railway configur√©es
- [ ] Frontend d√©ploy√© sur Vercel
- [ ] Variable `VITE_BACKEND_URL` Vercel configur√©e
- [ ] Webhook Stripe production cr√©√©
- [ ] Test de paiement production r√©ussi
- [ ] Emails de confirmation fonctionnent

---

## üéâ F√âLICITATIONS !

Si vous avez suivi toutes les √©tapes, votre site **Ghost Remix Pack** est maintenant :

‚úÖ **Fonctionnel localement**
‚úÖ **D√©ploy√© en production**
‚úÖ **Pr√™t √† accepter des paiements**
‚úÖ **Configur√© pour envoyer des emails**
‚úÖ **S√©curis√© avec Firebase**

---

## üìà PROCHAINES √âTAPES

1. **Ajouter vos vrais fichiers audio** dans `public/audio/`
2. **Personnaliser le contenu** dans `src/components/GhostRemixPack.tsx`
3. **Passer en mode production Stripe** (remplacer `sk_test_VOTRE_CLE_TEST_ICI` par `sk_live_VOTRE_CLE_LIVE_ICI`)
4. **Configurer un nom de domaine personnalis√©**
5. **Ajouter Google Analytics** (optionnel)
6. **Am√©liorer le SEO** (meta tags, etc.)

---

**üöÄ Bon lancement avec votre site Ghost Remix Pack !**

---

_Document cr√©√© le 15 octobre 2025_
_Version 1.0_

